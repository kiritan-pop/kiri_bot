from typing import List
from kiribo.openai_service import predict, is_alive


SYSTEM_PROMPT = """あなたは与えられたメイン食材を元に独創的な料理を考え、そのレシピを提案してください。
メイン食材の他に必要な調味料や食材もあわせて記載してください。
可能な限り日本語で出力してください。

出力フォーマット
```json
{
"材料・調味料" : {
    "材料名1": "分量",
    "材料名2": "分量"
    },
"料理手順": {
    "1.手順タイトル": "料理手順",
    "2.手順タイトル": "料理手順"
    },
"料理名" : "独創的な料理名（詩的表現を使って）"
}
```

** "分量"の記載例 **
  150g, 200ml, 小さじ2, 大さじ1, 1個, 2枚, 3本, ひとつまみ, 少々, お好みで


出力例１
input:
卵, 牛肉, タマネギ, もやし

output:
```json
{
  "材料・調味料": {
    "卵": "3個",
    "牛肉": "200g",
    "タマネギ": "1個",
    "もやし": "100g",
    "醤油": "大さじ2",
    "みりん": "大さじ1",
    "砂糖": "小さじ1",
    "塩": "少々",
    "コショウ": "少々",
    "ごま油": "小さじ1",
    "万能ねぎ": "お好みで"
  },
  "料理手順": {
    "1.下ごしらえ": "牛肉は一口大に切り、醤油、みりん、砂糖で5分ほど下味をつけます。タマネギは薄切り、もやしは軽く洗って水気を切ります。",
    "2.牛肉とタマネギを炒める": "フライパンにごま油を熱し、牛肉を炒めます。色が変わったらタマネギを加えて炒め、しんなりしたら取り出します。",
    "3.卵の準備": "ボウルに卵を割り入れ、塩とコショウを少々加えて軽く混ぜます。",
    "4.卵ともやしの調理": "同じフライパンにもやしを軽く炒め、塩少々で味を調えます。その上に溶き卵を流し入れ、ふんわりと固まるまで弱火で火を通します。",
    "5.仕上げ": "卵ともやしの上に炒めた牛肉とタマネギを乗せ、万能ねぎを散らして完成です。"
  },
  "料理名": "彩り舞う卵の花畑 ～牛肉とタマネギの調べ～"
}
```

--
メイン食材は以下の通りです。
input:
"""

def get_recipe(zairyo_list: List):
    if is_alive():
      user_prompt = ",".join(zairyo_list)

      response = predict(SYSTEM_PROMPT, user_prompt)
      return response
    else:
      return None
